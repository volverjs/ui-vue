import { ref } from 'vue'
import { Meta, Story } from '@storybook/addon-docs'
import VvDropdown from '@/components/VvDropdown/VvDropdown.vue'
import VvIcon from '@/components/VvIcon/VvIcon.vue'
import VvDropdownAction from '@/components/VvDropdown/VvDropdownAction.vue'
import { defaultTest } from './Dropdown.test'
import { defaultArgs, argTypes } from './Dropdown.settings'

<Meta
	title="Components/Dropdown/Slots"
	component={VvDropdown}
	argTypes={argTypes}
	args={defaultArgs}
/>

export const Template = (args, { argTypes }) => ({
	props: Object.keys(argTypes),
	components: { VvDropdown, VvDropdownAction, VvIcon },
	setup() {
		const expanded = ref(false)
		return { args, expanded }
	},
	watch: {
		expanded(newValue) {
			if (!newValue) {
				return
			}
			setTimeout(() => {
				this.centerWrapper()
			}, 300)
		},
	},
	methods: {
		centerWrapper() {
			document.getElementById('toggle-button').scrollIntoView({
				inline: 'center',
				block: 'center',
			})
		},
	},
	mounted() {
		this.centerWrapper()
	},
	template: /* html */ `
		<div class="absolute inset-0 overflow-auto" ref="container">
			<div style="width: 200%; height: 200%" ref="wrapper" data-testId="wrapper">
				<vv-dropdown v-model="expanded" v-bind="args">
                    <template #before v-if="args.before"><div v-html="args.before"></div></template>
                    <template #default="{ init, toggle, aria }">
                        <button :ref="(e) => init(e)" v-bind="aria" id="toggle-button" class="absolute cursor-pointer bg-info p-lg text-center top-full left-full -translate-1/2" data-testId="trigger" @click="toggle">
                            Toggle dropdown
                        </button>
                    </template>
					<template #items>
						<vv-dropdown-action>
							<vv-icon name="add" /> Create
						</vv-dropdown-action>
						<vv-dropdown-action>
							<vv-icon name="edit" /> Update
						</vv-dropdown-action>
						<vv-dropdown-action>
							<vv-icon name="trash" /> Delete
						</vv-dropdown-action>
					</template>
                    <template #after v-if="args.after"><div v-html="args.after"></div></template>
				</vv-dropdown>
			</div>
		</div>
	`,
})

<Canvas>
	<Story name="Default" play={defaultTest}>
		{Template.bind()}
	</Story>
</Canvas>

<Canvas>
	<Story
		name="Before"
		args={{
			before: '<div class="bg-warning p-xs text-center">Before</div>',
		}}
		argTypes={{
			before: {
				control: {
					disable: true,
				},
			},
		}}
		play={defaultTest}
	>
		{Template.bind()}
	</Story>
</Canvas>

<Canvas>
	<Story
		name="After"
		args={{
			after: '<div class="bg-danger text-white p-xs text-center">After</div>',
		}}
		argTypes={{
			after: {
				control: {
					disable: true,
				},
			},
		}}
		play={defaultTest}
	>
		{Template.bind()}
	</Story>
</Canvas>
