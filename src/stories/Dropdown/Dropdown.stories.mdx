import { ref } from 'vue'
import { Meta, Story } from '@storybook/addon-docs'
import VvDropdown from '@/components/VvDropdown/VvDropdown.vue'
import VvDropdownAction from '@/components/VvDropdown/VvDropdownAction.vue'
import VvIcon from '@/components/VvIcon/VvIcon.vue'
import VvButton from '@/components/VvButton/VvButton.vue'
import { defaultTest } from './Dropdown.test'
import { defaultArgs, argTypes } from './Dropdown.settings'

<Meta
	title="Components/Dropdown"
	component={VvDropdown}
	argTypes={argTypes}
	args={defaultArgs}
/>

export const Template = (args, { argTypes }) => ({
	props: Object.keys(argTypes),
	components: { VvDropdown, VvDropdownAction, VvIcon, VvButton },
	setup() {
		const expanded = ref(false)
		return { args, expanded }
	},
	watch: {
		expanded(newValue) {
			if (!newValue) {
				return
			}
			setTimeout(() => {
				this.centerWrapper()
			}, 300)
		},
	},
	methods: {
		centerWrapper() {
			this.$refs.toggle?.$el?.scrollIntoView({
				inline: 'center',
				block: 'center',
			})
		},
	},
	mounted() {
		this.centerWrapper()
	},
	template: /* html */ `
		<div class="absolute inset-0 overflow-auto" ref="container">
			<div style="width: 200%; height: 200%" ref="wrapper" data-testId="wrapper">
				<vv-dropdown v-model="expanded" v-bind="args">
					<vv-button ref="toggle" class="absolute top-full left-full -translate-1/2" modifiers="full-bleed" data-testId="trigger">
						Toggle dropdown
					</vv-button>
					<template #items>
						<vv-dropdown-action>
							<vv-icon name="add" /> Create
						</vv-dropdown-action>
						<vv-dropdown-action>
							<vv-icon name="edit" /> Update
						</vv-dropdown-action>
						<vv-dropdown-action>
							<vv-icon name="trash" /> Delete
						</vv-dropdown-action>
					</template>
				</vv-dropdown>
			</div>
		</div>
	`,
})

<Canvas>
	<Story name="Default" play={defaultTest}>
		{Template.bind()}
	</Story>
</Canvas>

<Canvas>
	<Story
		name="Arrow"
		args={{ arrow: true, offset: 10 }}
		argTypes={{
			arrow: {
				control: {
					disable: true,
				},
			},
		}}
		play={defaultTest}
	>
		{Template.bind()}
	</Story>
</Canvas>

<Canvas>
	<Story
		name="Auto placement"
		args={{ flip: false, autoPlacement: true, arrow: true, offset: 10 }}
		argTypes={{
			autoPlacement: {
				control: {
					disable: true,
				},
			},
		}}
		play={defaultTest}
	>
		{Template.bind()}
	</Story>
</Canvas>

<Canvas>
	<Story
		name="Trigger width"
		args={{ triggerWidth: true }}
		argTypes={{
			triggerWidth: {
				control: {
					disable: true,
				},
			},
		}}
		play={defaultTest}
	>
		{Template.bind()}
	</Story>
</Canvas>
